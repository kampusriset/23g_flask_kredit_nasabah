{% extends 'base.html' %}
{% block title %}Nasabah{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3" style="animation: fadeIn 1s ease-in-out;">
  <div>
    <h1 class="h3 fw-bold text-dark mb-0">
      <i class="bi bi-people-fill text-primary me-2"></i>
      Manajemen Nasabah
    </h1>
    <p class="text-muted small mb-0 mt-1">Data lengkap nasabah dan profil kredit</p>
  </div>
  <div>
    <a href="{{ url_for('nasabah.export') }}" class="btn btn-success text-white">
      <i class="bi bi-file-earmark-excel me-1"></i> Export Excel
    </a>
  </div>
</div>

<!-- Search & Filter Card -->
<div class="card shadow-sm border-0 mb-4" style="animation: fadeIn 1s ease-in-out 0.2s both;">
  <div class="card-header bg-white border-bottom py-3 d-flex align-items-center gap-2">
    <i class="bi bi-funnel text-primary"></i>
    <h5 class="mb-0 fs-6 fw-bold">Filter Pencarian</h5>
  </div>
  <div class="card-body bg-light-subtle">
    <form method="GET" action="{{ url_for('nasabah.index') }}" class="row g-3">
      <div class="col-md-3">
        <label class="form-label small text-muted text-uppercase fw-bold"><i class="bi bi-search me-1"></i> Nama</label>
        <input type="text" name="q" class="form-control" placeholder="Cari nama..." value="{{ q if q else '' }}">
      </div>
      <div class="col-md-3">
        <label class="form-label small text-muted text-uppercase fw-bold"><i class="bi bi-card-heading me-1"></i> NIK</label>
        <input type="text" name="nik" class="form-control" placeholder="Cari NIK..." value="{{ nik if nik else '' }}">
      </div>
      <div class="col-md-3">
        <label class="form-label small text-muted text-uppercase fw-bold"><i class="bi bi-telephone me-1"></i> No. Telp</label>
        <input type="text" name="no_telp" class="form-control" placeholder="Cari telepon..." value="{{ no_telp if no_telp else '' }}">
      </div>
      <div class="col-md-3">
        <label class="form-label small text-muted text-uppercase fw-bold"><i class="bi bi-cash me-1"></i> Min. Penghasilan</label>
        <input type="number" name="min_penghasilan" class="form-control" placeholder="Rp 0" value="{{ min_penghasilan if min_penghasilan else '' }}">
      </div>
      <div class="col-12 text-end mt-3">
        <a href="{{ url_for('nasabah.index') }}" class="btn btn-light border me-2">
          <i class="bi bi-arrow-counterclockwise"></i> Reset
        </a>
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-search me-1"></i> Terapkan Filter
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Nasabah Table -->
<div class="card shadow-sm" style="animation: fadeIn 1s ease-in-out 0.4s both;">
  <div class="card-header bg-white border-bottom py-3 d-flex align-items-center gap-2">
    <i class="bi bi-table text-primary"></i>
    <h5 class="mb-0 fs-6 fw-bold">Daftar Nasabah ({{ total }} data)</h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th class="px-4 py-3 text-uppercase small fw-bold text-muted">No</th>
            <th class="px-4 py-3 text-uppercase small fw-bold text-muted">Nama Lengkap</th>
            <th class="px-4 py-3 text-uppercase small fw-bold text-muted">NIK</th>
            <th class="px-4 py-3 text-uppercase small fw-bold text-muted">Telepon</th>
            <th class="px-4 py-3 text-uppercase small fw-bold text-muted">Penghasilan</th>
            <th class="px-4 py-3 text-uppercase small fw-bold text-muted text-end">Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% if nasabah %}
            {% for n in nasabah %}
            <tr>
              <td class="px-4 py-3 text-muted">{{ loop.index }}</td>
              <td class="px-4 py-3 fw-bold text-dark">{{ n.nama }}</td>
              <td class="px-4 py-3 font-monospace small">{{ n.nik }}</td>
              <td class="px-4 py-3">{{ n.no_telp }}</td>
              <td class="px-4 py-3 fw-bold text-success">Rp {{ '{:,.0f}'.format(n.penghasilan) }}</td>
              <td class="px-4 py-3 text-end">
                <div class="d-flex justify-content-end gap-2">
                  <a href="{{ url_for('nasabah.detail', id=n.id) }}" class="btn btn-sm btn-outline-primary" title="Detail">
                    <i class="bi bi-eye"></i>
                  </a>
                  <a href="{{ url_for('nasabah.edit', id=n.id) }}" class="btn btn-sm btn-outline-success" title="Edit">
                    <i class="bi bi-pencil"></i>
                  </a>
                  <form method="POST" action="{{ url_for('nasabah.hapus', id=n.id) }}" class="d-inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Yakin ingin hapus data nasabah ini?')" title="Hapus">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center py-5">
                <div class="text-muted">
                  <i class="bi bi-inbox display-1 text-light-emphasis d-block mb-3"></i>
                  Data nasabah tidak ditemukan
                </div>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}
