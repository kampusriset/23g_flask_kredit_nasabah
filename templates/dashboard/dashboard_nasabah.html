{% extends 'base.html' %}
{% block title %}Dashboard Nasabah{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <!-- DASHBOARD HEADER WITH ILLUSTRATION -->
  <div class="dashboard-header-banner" style="animation: fadeIn 1s ease-in-out;">
    <div class="banner-content">
      <div class="banner-text">
        <h2><i class="bi bi-person-circle"></i> Dashboard Nasabah</h2>
        <span class="text-muted">Selamat datang, <strong>{{ nasabah.nama }}</strong></span>
      </div>
      <svg class="banner-illustration" viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg">
        <!-- Decorative person icon -->
        <circle cx="100" cy="40" r="25" fill="#7b4a39" opacity="0.7"/>
        <rect x="85" y="65" width="30" height="40" fill="#a0684f" opacity="0.8" rx="5"/>
        <circle cx="180" cy="20" r="15" fill="#f4a261" opacity="0.5"/>
      </svg>
    </div>
  </div>

  <div class="page-header">
    <h2 style="display: none;"><i class="bi bi-person-circle"></i> Dashboard Nasabah</h2>
    <span class="text-muted" style="display: none;">Selamat datang, <strong>{{ nasabah.nama }}</strong></span>
  </div>

  <div class="row g-4 mb-4" style="animation: fadeIn 1s ease-in-out 0.2s both;">
    <!-- Pengajuan Stats -->
    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <div class="stat-card-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
          </svg>
        </div>
        <h5><i class="bi bi-file-earmark"></i> Total Pengajuan</h5>
        <div class="d-flex justify-content-between align-items-center">
          <div class="stat-value">{{ total_pengajuan }}</div>
          <div class="stat-icon">üìã</div>
        </div>
        <small class="text-muted">Pengajuan kredit Anda</small>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <div class="stat-card-icon success">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
        </div>
        <h5><i class="bi bi-check-circle"></i> Disetujui</h5>
        <div class="d-flex justify-content-between align-items-center">
          <div class="stat-value text-success">{{ pengajuan_disetujui }}</div>
          <div class="stat-icon">‚úì</div>
        </div>
        <small class="text-muted">Pengajuan diterima</small>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <div class="stat-card-icon warning">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="currentColor" d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/>
          </svg>
        </div>
        <h5><i class="bi bi-clock-history"></i> Menunggu</h5>
        <div class="d-flex justify-content-between align-items-center">
          <div class="stat-value text-warning">{{ pengajuan_menunggu }}</div>
          <div class="stat-icon">‚è≥</div>
        </div>
        <small class="text-muted">Dalam verifikasi</small>
      </div>
    </div>

    <div class="col-md-6 col-lg-3">
      <div class="stat-card">
        <div class="stat-card-icon danger">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path fill="currentColor" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
          </svg>
        </div>
        <h5><i class="bi bi-x-circle"></i> Ditolak</h5>
        <div class="d-flex justify-content-between align-items-center">
          <div class="stat-value text-danger">{{ pengajuan_ditolak }}</div>
          <div class="stat-icon">‚úó</div>
        </div>
        <small class="text-muted">Pengajuan ditolak</small>
      </div>
    </div>
  </div>

  <!-- Outstanding & Payment Stats -->
  <div class="row g-4" style="animation: fadeIn 1s ease-in-out 0.4s both;">
    <div class="col-lg-6">
      <div class="card compact-chart-card">
        <div class="card-header">
          <i class="bi bi-cash-coin"></i> Total Outstanding
        </div>
        <div class="card-body">
          <div class="text-center">
            <h3 class="text-success"><span class="currency">Rp {{ '{:,.0f}'.format(total_outstanding or 0) }}</span></h3>
            <small class="text-muted">Total pinjaman yang disetujui</small>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card compact-chart-card">
        <div class="card-header">
          <i class="bi bi-receipt"></i> Status Pembayaran
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-4">
              <h5 class="text-success">{{ pembayaran_sudah }}</h5>
              <small class="text-muted">Sudah Bayar</small>
            </div>
            <div class="col-4">
              <h5 class="text-warning">{{ pembayaran_belum }}</h5>
              <small class="text-muted">Belum Bayar</small>
            </div>
            <div class="col-4">
              <h5 class="text-danger">Rp {{ '{:,.0f}'.format(total_denda or 0) }}</h5>
              <small class="text-muted">Total Denda</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notifikasi Pembayaran Jatuh Tempo -->
  {% if jatuh_tempo %}
  <div class="row g-4 mt-2" style="animation: fadeIn 1s ease-in-out 0.6s both;">
    <div class="col-12">
      <div class="card border-warning">
        <div class="card-header bg-warning text-dark">
          <i class="bi bi-exclamation-triangle"></i> Notifikasi Pembayaran Jatuh Tempo
        </div>
        <div class="card-body">
          <div class="alert alert-warning">
            <h6><i class="bi bi-calendar-x"></i> Anda memiliki {{ jatuh_tempo|length }} pembayaran yang jatuh tempo</h6>
            <p class="mb-2">Silakan segera lakukan pembayaran untuk menghindari denda keterlambatan.</p>
            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Bulan Ke</th>
                    <th>Jumlah</th>
                    <th>Jatuh Tempo</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in jatuh_tempo %}
                  <tr>
                    <td>{{ item.bulan_ke }}</td>
                    <td>Rp {{ '{:,.0f}'.format(item.jumlah_bayar) }}</td>
                    <td>{{ item.tanggal_jatuh_tempo.strftime('%d/%m/%Y') }}</td>
                    <td>
                      <button class="btn btn-sm btn-success" onclick="bayarSekarang({{ item.id }})">
                        <i class="bi bi-credit-card"></i> Bayar Sekarang
                      </button>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Quick Actions -->
  <div class="row g-4 mt-2" style="animation: fadeIn 1s ease-in-out 0.6s both;">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-lightning"></i> Aksi Cepat
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <a href="{{ url_for('pengajuan.ajukan') }}" class="btn btn-primary btn-lg w-100">
                <i class="bi bi-plus-circle"></i> Ajukan Kredit Baru
              </a>
            </div>
            <div class="col-md-4">
              <a href="{{ url_for('pembayaran.jadwal_pembayaran', pengajuan_id=0) }}" class="btn btn-jadwal-pembayaran btn-lg w-100">
                <i class="bi bi-calendar-event"></i> Lihat Jadwal Pembayaran
              </a>
            </div>
            <div class="col-md-4">
              <a href="{{ url_for('info.index') }}" class="btn btn-secondary btn-lg w-100">
                <i class="bi bi-info-circle"></i> Informasi Layanan
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<script>
function bayarSekarang(paymentId) {
    if (confirm('Apakah Anda ingin melakukan pembayaran sekarang?')) {
        // Implementasi pembayaran - bisa menggunakan AJAX atau redirect
        alert('Fitur pembayaran akan diimplementasikan');
    }
}
</script>

{% endblock %}
